function Actor(b,a){this.x=this.prev_x=0;this.y=this.prev_y=0;this.hitbox=b;this.sprite=new Sprite(a);this.x_velocity=0;this.y_velocity=0;this.prev_frame=null;this.timer=null;this.timer_callback=null;}Actor.prototype.init=function(a,c,b){this.x=this.prev_x=a;this.y=this.prev_y=c;this.sprite.init(b);this.prev_frame=this.sprite.getCurrentFrame();};Actor.prototype.step=function(a){this.prethink(a);this.prev_x=this.x;this.prev_y=this.y;this.prev_frame=this.sprite.getCurrentFrame();this.x+=(this.x_velocity*a);this.y+=(this.y_velocity*a);this.sprite.advanceAnimation(a);if(this.timer>0){this.timer-=a;if(this.timer<=0){this.timer_callback.call(this);}}this.think(a);};Actor.prototype.setTimer=function(a,b){this.timer=a;if(!this[b]){throw"No method found: "+b;}this.timer_callback=this[b];};Actor.prototype.clearTimer=function(){this.timer=0;this.timer_callback=null;};Actor.prototype.think=function(a){};Actor.prototype.prethink=function(a){};Actor.prototype._getInternalHitbox=function(){var a=this.sprite.getCurrentFrame().getHitbox();return(a==null)?this.hitbox:a;};Actor.prototype.getHitbox=function(){var a=this._getInternalHitbox();return new Rectangle(this.x+a.x,this.y+a.y,a.width,a.height);};Actor.prototype.getPreviousHitbox=function(){var b=this.prev_frame.getHitbox();var a=(b==null)?this.hitbox:b;return new Rectangle(this.prev_x+a.x,this.prev_y+a.y,a.width,a.height);};Actor.prototype.collisionTest=function(c){if(this.getHitbox().collidesWith(c.getHitbox())){var a=this.getPreviousHitbox().getSideOf(c.getPreviousHitbox());var b=c.getPreviousHitbox().getSideOf(this.getPreviousHitbox());this.oncollide(c,a);c.oncollide(this,b);}};Actor.prototype.stopAll=function(){this.x_velocity=0;this.y_velocity=0;};Actor.prototype.stopHorizontal=function(){this.x_velocity=0;};Actor.prototype.stopVertical=function(){this.y_velocity=0;};Actor.prototype.setVelocityByAngle=function(a,b){this.x_velocity=Math.cos(b)*a;this.y_velocity=Math.sin(b)*a;};Actor.prototype.oncollide=function(b,a){};Actor.prototype.collideStop=function(b,a){if(a.getSide(CollisionSides.sides.LEFT)){if(this.x_velocity<0){this.stopHorizontal();}this.x=b.getHitbox().right_x()-this._getInternalHitbox().x+0.01;}else{if(a.getSide(CollisionSides.sides.RIGHT)){if(this.x_velocity>0){this.stopHorizontal();}this.x=b.getHitbox().x-this._getInternalHitbox().right_x()-0.01;}}if(a.getSide(CollisionSides.sides.TOP)){if(this.y_velocity<0){this.stopVertical();}this.y=b.getHitbox().bottom_y()-this._getInternalHitbox().y+0.01;}else{if(a.getSide(CollisionSides.sides.BOTTOM)){if(this.y_velocity>0){this.stopVertical();}this.y=b.getHitbox().y-this._getInternalHitbox().bottom_y()-0.01;}}};Actor.prototype.collideBounce=function(c,a,d){if(!d){d=1;}var b=c.getHitbox();if(a.getSide(CollisionSides.sides.TOP)){this.y=b.bottom_y()-this.hitbox.y+0.01;if(this.y_velocity<0){this.y_velocity=-this.y_velocity*d;}}else{if(a.getSide(CollisionSides.sides.BOTTOM)){this.y=b.y-this.hitbox.bottom_y()-0.01;if(this.y_velocity>0){this.y_velocity=-this.y_velocity*d;}}}if(a.getSide(CollisionSides.sides.LEFT)){this.x=b.right_x()-this.hitbox.x+0.01;if(this.x_velocity<0){this.x_velocity=-this.x_velocity*d;}}else{if(a.getSide(CollisionSides.sides.RIGHT)){this.x=b.x-this.hitbox.right_x()-0.01;if(this.x_velocity>0){this.x_velocity=-this.x_velocity*d;}}}};Actor.prototype.getCollisionSubframeTime=function(d,a){var c,b;var f,e;if(a){c=this.getHitbox().y;b=this.getPreviousHitbox().y;f=d.getHitbox().y;e=d.getHitbox().y;}else{c=this.getHitbox().x;b=this.getPreviousHitbox().x;f=d.getHitbox().x;e=d.getHitbox().x;}if(c-b==f-e){return NaN;}return(e-b)/(c-b+e-f);};Actor.prototype.getX=function(){return this.x;};Actor.prototype.getY=function(){return this.y;};Actor.prototype.display=function(a){this.sprite.display(this.getX(),this.getY(),a);};function Animation(a,c,b){this.name=a;this.frames=c;this.max_frames=c.length;this.continuous=b;}Animation.prototype.getFrame=function(a){return this.frames[a];};function BackgroundImage(a){this.file_name="backgrounds/"+a;this.image=new Image();this.image.onload=function(b){this.loaded=true;};this.image.src=this.file_name;this.parallax=0;}BackgroundImage.prototype.setParallax=function(a){this.parallax=a;};BackgroundImage.prototype.display=function(g,f,a,n,b){var m=this.image.width;var c=this.image.height;var l=new Rectangle(this.parallax*game.game_engine.camera_x,this.parallax*game.game_engine.camera_y,a,n);var k=Math.floor(l.x/m)*m;var h=Math.floor(l.y/c)*c;var p=Math.ceil(l.right_x()/m)*m;var o=Math.ceil(l.bottom_y()/c)*c;for(var e=k;e<p;e+=m){var j=Math.min(m,l.right_x()-e);for(var d=h;d<o;d+=c){var i=Math.min(c,l.bottom_y()-d);b.drawImage(this.image,0,0,j,i,g+e-l.x,f+d-l.y,j,i);}}};BackgroundImage.prototype.isLoaded=function(){return this.image.loaded;};function BackgroundImageMap(){this.backgrounds={};}BackgroundImageMap.prototype.addBackgroundImage=function(a,b){if(this.backgrounds[a]){throw"Duplicate background name:"+a;}if(!b instanceof BackgroundImage){throw"background_image is not a background image";}game.game_engine.preloader.registerItem(b);this.backgrounds[a]=b;};BackgroundImageMap.prototype.getBackgroundImage=function(a){return this.backgrounds[a];};BackgroundImageMap.prototype.getCount=function(){return Object.keys(this.backgrounds).length;};CollisionSides.sides={TOP:1,LEFT:2,RIGHT:-2,BOTTOM:-1};function CollisionSides(){this.collisions={1:false,"-1":false,2:false,"-2":false};}CollisionSides.prototype.setSide=function(a){this.collisions[a]=true;};CollisionSides.prototype.getSide=function(a){return this.collisions[a];};CollisionSides.prototype.removeSide=function(a){this.collisions[a]=false;};function Effect(a,c,b){this.x=a;this.y=c;this.total_time=b;this.time=0;this.removed=false;}Effect.prototype.step=function(a){this.time+=a;if(this.time>=this.total_time){game.game_state.removeEffect(this);}else{this.think(a);}};Effect.prototype.display=function(a){};SpriteEffect.prototype=Object.create(Effect.prototype);SpriteEffect.parent=Effect.prototype;function SpriteEffect(a,d,c,b){this.constructor(a,d);this.sprite=new Sprite(sprite_name);this.sprite.init(b);}SpriteEffect.prototype.think=function(a){this.sprite.advanceAnimation(a);};SpriteEffect.prototype.display=function(a){this.sprite.display(this.x,this.y,a);};function Frame(a,b,c){this.rect=a;this.duration=b;this.hitbox=c;}Frame.prototype.getHitbox=function(){return this.hitbox;};var game;function Game(a){this.game_phase_map=new GamePhaseMap();this.tile_map=new TileSetMap();this.sprite_sheet_map=new SpriteSheetMap();this.background_image_map=new BackgroundImageMap();this.game_state=new GameState();this.game_engine=new GameEngine();this.sound_map=new SoundMap();this.preloader_class_name=a;this.current_phase=null;}Game.prototype.initGamePhases=function(){};Game.prototype.initSpriteSheets=function(){};Game.prototype.initBackgroundImages=function(){};Game.prototype.initSounds=function(){};Game.prototype.initFonts=function(){};Game.prototype.initKeys=function(){};Game.prototype.initLevelMap=function(){};Game.prototype.initTiles=function(){};Game.prototype.initUI=function(){};Game.prototype.init=function(){this.initResolution();this.game_engine.init(this.WINDOW_HEIGHT,this.WINDOW_WIDTH,this.FRAME_RATE,this.preloader_class_name);this.initKeys();this.initSpriteSheets();this.initTiles();this.initBackgroundImages();this.initSounds();this.initFonts();this.initLevelMap();this.initUI();this.initGamePhases();this.game_state.init();};Game.prototype.initResolution=function(){this.WINDOW_HEIGHT=480;this.WINDOW_WIDTH=480;this.FRAME_RATE=60;};Game.prototype.getCurrentPhase=function(){if(this.current_phase==null){throw"Current phase has not been defined yet.";}return this.current_phase;};Game.prototype.initPhase=function(a){if(this.current_phase!=null){throw"initPhase should not be called more than once.";}this.current_phase=this.game_phase_map.getPhase(a);this.current_phase.transitionTo();};Game.prototype.transition=function(a){this.current_phase.transitionFrom();this.current_phase=this.game_phase_map.getPhase(a);this.current_phase.transitionTo();};function GameEngine(){this.frame_rate=60;this.prev_time=0;this.width=0;this.height=0;this.preloader={};this.key_handler={};this.fonts_loaded=false;this.audio_context=null;}GameEngine.prototype.init=function(f,b,e,d){this.frame_rate=e;this.width=f;this.height=b;this.key_handler=new KeyHandler();window.addEventListener("keyup",function(h){game.game_engine.key_handler.keyUp(h);},false);window.addEventListener("keydown",function(h){game.game_engine.key_handler.keyDown(h);},false);var c=document.getElementsByTagName("body").item(0);c.style.margin=0;var a=document.createElement("canvas");a.height=b;a.width=f;a.id="GAME_CANVAS";c.appendChild(a);var g=document.createElement("div");g.id="fonts";c.appendChild(g);if(typeof AudioContext!=="undefined"){this.audio_context=new AudioContext();}else{if(typeof webkitAudioContext!=="undefined"){this.audio_context=new webkitAudioContext();}}this.volume=5;this.gain_node=this.audio_context.createGain?this.audio_context.createGain():this.audio_context.createGainNode();this.gain_node.connect(this.audio_context.destination);this.camera_x=0;this.camera_y=0;window.onload=function(){game.game_engine.fonts_loaded=true;};this.prev_time=new Date().getTime()/1000;this.preloader=new window[d];this.preLoad();};GameEngine.prototype.setCamera=function(a,b){this.camera_x=a;this.camera_y=b;};GameEngine.prototype.getGraphicsContext=function(){return document.getElementById("GAME_CANVAS").getContext("2d");};GameEngine.prototype.getAudioContext=function(){return this.audio_context;};GameEngine.prototype.playSound=function(a){var b=this.audio_context.createBufferSource();b.buffer=a;b.connect(this.gain_node);b.start(0);};GameEngine.prototype.volumeUp=function(){this.volume++;if(this.volume>10){this.volume=10;}this.setVolume();};GameEngine.prototype.volumeDown=function(){this.volume--;if(this.volume<0){this.volume=0;}this.setVolume();};GameEngine.prototype.setVolume=function(){this.gain_node.gain.value=Math.cos((10-this.volume)*0.05*Math.PI);};GameEngine.prototype.getVolume=function(){return this.volume;};GameEngine.prototype.getDelta=function(){var a=new Date().getTime()/1000;delta=a-this.prev_time;this.prev_time=a;return delta;};GameEngine.prototype.gameLoop=function(){var b=this.getDelta();var a=game.getCurrentPhase();a.interpretInput(game.game_state,b,this.key_handler);this.key_handler.reset();a.updateLogic(game.game_state,b);this.getGraphicsContext().clearRect(0,0,this.width,this.height);a.renderGraphics(game.game_state,this.getGraphicsContext());setTimeout(function(){game.game_engine.gameLoop();},1000/this.frame_rate);};GameEngine.prototype.preLoad=function(){this.preloader.renderPreloader(this.getGraphicsContext());if(this.preloader.isDone()&&this.fonts_loaded){this.gameLoop();}else{setTimeout(function(){game.game_engine.preLoad();},1000/this.frame_rate);}};GameEngine.prototype.initFont=function(e,d,b){var a=document.createElement("style");a.appendChild(document.createTextNode('	@font-face {	    font-family: "'+e+"\";	    src: url('"+d+"') format('"+b+"');	}	"));document.head.appendChild(a);var c=document.createElement("div");c.style.fontFamily=e;c.appendChild(document.createTextNode(" "));document.getElementById("fonts").appendChild(c);};CanvasRenderingContext2D.prototype.fillRectObject=function(a){this.fillRect(a.x,a.y,a.width,a.height);};CanvasRenderingContext2D.prototype.strokeRectObject=function(a){this.strokeRect(a.x,a.y,a.width,a.height);};CanvasRenderingContext2D.prototype.moveToPoint=function(a){this.moveTo(a[0],a[1]);};CanvasRenderingContext2D.prototype.lineToPoint=function(a){this.lineTo(a[0],a[1]);};function GamePhase(a){this.transitions=a;}GamePhase.prototype.updateLogic=function(a,b){throw"updateLogic not defined.";};GamePhase.prototype.interpretInput=function(a,c,b){throw"interpretInput not defined.";};GamePhase.prototype.renderGraphics=function(a,c,b){throw"renderGraphics not defined.";};GamePhase.prototype.transitionFrom=function(){};GamePhase.prototype.transitionTo=function(){};function GamePhaseMap(){this.phases=new Object();}GamePhaseMap.prototype.addPhase=function(a,b,c){if(this.phases[a]){throw"Duplicate phase name: "+a;}this.phases[a]=new window[b](c);};GamePhaseMap.prototype.getPhase=function(a){if(!this.phases[a]){throw"Undefined phase name: "+a;}return this.phases[a];};function KeyHandler(){this.continuous_key_codes=new Array();this.pressed_key_codes=new Array();}KeyHandler.prototype.keyDown=function(a){var b;if(b=this.continuous_key_codes[a.keyCode]){this[b]=true;}else{if(b=this.pressed_key_codes[a.keyCode]){this[b]=true;}}};KeyHandler.prototype.keyUp=function(a){var b;if(b=this.continuous_key_codes[a.keyCode]){this[b]=false;}};KeyHandler.prototype.reset=function(){for(var b in this.pressed_key_codes){var a=this.pressed_key_codes[b];this[a]=false;}};KeyHandler.prototype.registerKey=function(a,b,c){if(c){this.continuous_key_codes[b]=a;}else{this.pressed_key_codes[b]=a;}this[a]=false;};KeyHandler.prototype.resetKeyCodes=function(){this.continuous_key_codes=new Array();this.pressed_key_codes=new Array();};function Level(a,b,c){this.object_initializer=a;this.geometry_initializer=b;this.background_image_name=c;}Level.prototype.renderBackground=function(a){this.background_image.display(0,0,game.WINDOW_WIDTH,game.WINDOW_HEIGHT,a);};Level.prototype.renderGeometry=function(a){this.geometry.display(0,0,a);};Level.prototype.init=function(){this.initBackground();this.initObjects(this.object_initializer);this.initGeometry(this.geometry_initializer);};Level.prototype.initBackground=function(){this.background_image=game.background_image_map.getBackgroundImage(this.background_image_name);};Level.prototype.initObjects=function(){throw ("initObjects not defined!");};Level.prototype.initGeometry=function(){throw ("initGeometry not defined!");};Level.prototype.geometryCheck=function(a){this.geometry.collisionCheck(a);};function Preloader(b,a){this.width=b;this.height=a;this.items=new Array();}Preloader.prototype.renderPreloader=function(a){};Preloader.prototype.registerItem=function(a){this.items.push(a);};Preloader.prototype.getTotalCount=function(){return this.items.length;};Preloader.prototype.getLoadedCount=function(){return this.items.filter(function(a){if(a.isLoaded()){return true;}else{return false;}}).length;};Preloader.prototype.isDone=function(){if(this.getTotalCount()==this.getLoadedCount()){return true;}else{return false;}};function Rectangle(b,d,c,a){this.x=b;this.y=d;this.width=c;this.height=a;}Rectangle.prototype.right_x=function(){return this.x+this.width;};Rectangle.prototype.bottom_y=function(){return this.y+this.height;};Rectangle.prototype.contains=function(a,b){if(a>this.x&&a<this.right_x()&&b>this.y&&b<this.bottom_y()){return true;}return false;};Rectangle.prototype.collidesWith=function(a){if(this.contains(a.x,a.y)||this.contains(a.x,a.bottom_y())||this.contains(a.right_x(),a.y)||this.contains(a.right_x(),a.bottom_y())){return true;}else{if(a.contains(this.x,this.y)||a.contains(this.x,this.bottom_y())||a.contains(this.right_x(),this.y)||a.contains(this.right_x(),this.bottom_y())){return true;}else{if(this.x<a.x&&this.right_x()>a.right_x()&&this.y>a.y&&this.bottom_y()<a.bottom_y()){return true;}else{if(this.x>a.x&&this.right_x()<a.right_x()&&this.y<a.y&&this.bottom_y()>a.bottom_y()){return true;}}}}return false;};Rectangle.prototype.getSideOf=function(b){var a=new CollisionSides();if(b.right_x()<this.x){a.setSide(CollisionSides.sides.LEFT);}if(b.x>this.right_x()){a.setSide(CollisionSides.sides.RIGHT);}if(b.bottom_y()<this.y){a.setSide(CollisionSides.sides.TOP);}if(b.y>this.bottom_y()){a.setSide(CollisionSides.sides.BOTTOM);}return a;};function SoundMap(){this.sounds={};}SoundMap.prototype.addSound=function(a,b){if(this.sounds[a]){throw"Duplicate sound name:"+a;}if(!b instanceof Sound){throw"sound is not a sound";}this.sounds[a]=b;game.game_engine.preloader.registerItem(b);};SoundMap.prototype.getSound=function(a){return this.sounds[a];};SoundMap.prototype.getCount=function(){return Object.keys(this.sounds).length;};function Sound(a){this.file_name=a;this.loaded=false;this.buffer=null;this.load();}Sound.prototype.load=function(){var a=new XMLHttpRequest();a.open("GET","sounds/"+this.file_name,true);a.responseType="arraybuffer";a.sound=this;a.onload=function(){var b=game.game_engine.getAudioContext();game.current_sound=a.sound;b.decodeAudioData(a.response,function d(e){a.sound.buffer=e;a.sound.loaded=true;},function c(){alert("Decoding the audio buffer failed");});};a.send();};Sound.prototype.handleLoad=function(c){var b=c.target;var a=game.game_engine.getAudioContext();this.buffer=a.createBuffer(b.response,true);this.loaded=true;};Sound.prototype.play=function(){game.game_engine.playSound(this.buffer);};Sound.prototype.isLoaded=function(){return this.loaded;};function Sprite(a){this.width_scaling=1;this.height_scaling=1;this.sprite_name=a;}Sprite.prototype.init=function(b){this.sprite_sheet=game.sprite_sheet_map.getSpriteSheet(this.sprite_name);if(b){for(var a=0;a<this.sprite_sheet.animations.length;a++){if(this.sprite_sheet.animations[a].name==b){this.current_animation=this.sprite_sheet.animations[a];}}}else{this.current_animation=this.sprite_sheet.animations[0];}this.resetAnimation();};Sprite.prototype.getAnimations=function(){return this.sprite_sheet.animations;};Sprite.prototype.playAnimation=function(b){for(var a=0;a<this.sprite_sheet.animations.length;a++){if(this.sprite_sheet.animations[a].name==b){this.current_animation=this.sprite_sheet.animations[a];this.resetAnimation();return;}}throw"The animation name "+b+" for spritesheet "+this.sprite_sheet.file_name+" was not found.";};Sprite.prototype.resetAnimation=function(){this.current_frame=0;this.frame_delta=0;this.animation_done=false;};Sprite.prototype.scale=function(b,a){if(!a){a=b;}this.width_scaling=b;this.height_scaling=a;};Sprite.prototype.display=function(j,i,c){var d=this.getCurrentFrame();if(!d){return;}var b=d.rect.x;var a=d.rect.y;var h=d.rect.height;var g=d.rect.width;var f=game.game_engine.camera_x;var e=game.game_engine.camera_y;c.drawImage(this.sprite_sheet.image,b,a,g,h,j-f,i-e,g*this.width_scaling,h*this.height_scaling);};Sprite.prototype.advanceAnimation=function(b){if(this.animation_done){return;}this.frame_delta+=b;var a=this.getCurrentFrame().duration;while(this.frame_delta>a){this.current_frame++;if(this.current_frame>=this.current_animation.max_frames){if(this.current_animation.continuous){this.current_frame-=this.current_animation.max_frames;}else{this.current_frame=this.current_animation.max_frames-1;this.animation_done=true;}}this.frame_delta-=a;}};Sprite.prototype.getCurrentFrame=function(){if(this.current_animation==null){return new Frame();}return this.current_animation.getFrame(this.current_frame);};function SpriteSheet(b,a){this.file_name="sprites/"+b;this.animations=a;this.image=new Image();this.image.onload=function(c){this.loaded=true;};this.image.src=this.file_name;}SpriteSheet.prototype.isLoaded=function(){return this.image.loaded;};function SpriteSheetMap(){this.sprite_sheets={};}SpriteSheetMap.prototype.addSpriteSheet=function(a,b){if(this.sprite_sheets[a]){throw"Duplicate spritesheet name:"+a;}if(!b instanceof SpriteSheet){throw"sprite_sheet is not a sprite sheet";}this.sprite_sheets[a]=b;game.game_engine.preloader.registerItem(b);};SpriteSheetMap.prototype.getSpriteSheet=function(a){return this.sprite_sheets[a];};SpriteSheetMap.prototype.getSpriteNames=function(){return Object.keys(this.sprite_sheets);};SpriteSheetMap.prototype.getCount=function(){return Object.keys(this.sprite_sheets).length;};function TileGeometry(b,d,a,c,e){this.tile_size=b;this.width=d;this.height=a;this.string=c;this.tiles_wide=Math.ceil(this.width/this.tile_size);this.tile_set=game.tile_map.getTileSet(e);}TileGeometry.prototype.checkPixel=function(b,d){if(b<0||d<0||b>this.width||d>this.height){return false;}var a=Math.floor(b/this.tile_size);var c=Math.floor(d/this.tile_size);if(this._getTileAt(a,c)!=" "){return true;}return false;};TileGeometry.prototype.collisionCheck=function(c){var n=c.getHitbox();var f=c.getPreviousHitbox();for(var a=n.x;a<n.right_x()+this.tile_size;a+=this.tile_size){for(var o=n.y;o<n.bottom_y()+this.tile_size;o+=this.tile_size){if(a>n.right_x()){a=n.right_x();}if(o>n.bottom_y()){o=n.bottom_y();}if(this.checkPixel(a,o)){var d=a-n.x;var b=o-n.y;var k=f.x+d;var j=f.y+b;var m=Math.floor(a/this.tile_size);var l=Math.floor(o/this.tile_size);var i=Math.floor(k/this.tile_size);var h=Math.floor(j/this.tile_size);var g=new CollisionSides();if(l<h&&this._getTileAt(m,h)==" "){g.setSide(CollisionSides.sides.TOP);}else{if(l>h&&this._getTileAt(m,h)==" "){g.setSide(CollisionSides.sides.BOTTOM);}}if(m<i&&this._getTileAt(i,l)==" "){g.setSide(CollisionSides.sides.LEFT);}else{if(m>i&&this._getTileAt(i,l)==" "){g.setSide(CollisionSides.sides.RIGHT);}}var e=new LevelTile(m*this.tile_size,l*this.tile_size,this.tile_size,this._getTileAt(m,l));c.oncollide(e,g);}}}};TileGeometry.prototype._getTileAt=function(a,b){return this.string.charAt(b*this.tiles_wide+a);};TileGeometry.prototype.display=function(a,g,d){var f=a,e=g;for(var c=0;c<this.string.length;c++){var b=this.string.charAt(c);if(b!=" "){this.tile_set.display(f,e,b,d);}f+=this.tile_size;if(f>=game.WINDOW_WIDTH){f=a;e+=this.tile_size;}}};TileGeometry.prototype.getTileSize=function(){return this.tile_size;};LevelTile.prototype=Object.create(Actor.prototype);LevelTile.parent=Actor.prototype;function LevelTile(a,d,b,c){this.constructor(new Rectangle(0,0,b,b),null);this.init(a,d,"null");this.id=c;}LevelTile.prototype.init=function(a,b){this.x=a;this.y=b;};function TileSet(b,a){this.file_name="tiles/"+b;this.tiles=a;this.image=new Image();this.image.onload=function(c){this.loaded=true;};this.image.src=this.file_name;}TileSet.prototype.isLoaded=function(){return this.image.loaded;};TileSet.prototype.display=function(a,g,f,c){var b=this.tiles[f];if(!b){return;}var e=game.game_engine.camera_x;var d=game.game_engine.camera_y;c.drawImage(this.image,b.x,b.y,b.width,b.height,a-e,g-d,b.width,b.height);};TileSet.prototype.getCount=function(){return this.tiles.length;};function TileSetMap(){this.tile_sets={};}TileSetMap.prototype.addTileSet=function(a,b){if(this.tile_sets[a]){throw"Duplicate tileset name:"+a;}if(!b instanceof TileSet){throw"tile_set is not a tile_set";}this.tile_sets[a]=b;game.game_engine.preloader.registerItem(b);};TileSetMap.prototype.getTileSet=function(a){return this.tile_sets[a];};TileSetMap.prototype.getTileSetNames=function(){return Object.keys(this.tile_sets);};TileSetMap.prototype.getCount=function(){return Object.keys(this.tile_sets).length;};function UIElement(){}UIElement.prototype.getValue=function(){throw"getValue not defined.  It should return the value for the UIElement to display.";};UIElement.prototype.display=function(a){throw"display not defined.";};UIElement.prototype.setPosition=function(a,b){this.x=a;this.y=b;};SpriteRepeaterUIElement.prototype=Object.create(UIElement.prototype);SpriteRepeaterUIElement.parent=UIElement.prototype;function SpriteRepeaterUIElement(b,d,a,c){this.sprite_width=d;this.sprite_height=a;this.padding=c;this.sprite=new Sprite(b);this.sprite.init();}SpriteRepeaterUIElement.prototype.display=function(b){var d=this.x;var c=this.getValue();for(var a=0;a<c;a++){this.sprite.display(d,this.y,b);d+=this.sprite_width+this.padding;}};TextUIElement.prototype=Object.create(UIElement.prototype);TextUIElement.parent=UIElement.prototype;function TextUIElement(b,a){this.font=b;this.color=a;}TextUIElement.prototype.display=function(a){a.fillStyle=this.color;a.textAlign="right";a.font=this.font;a.textBaseline="top";a.fillText(this.getValue(),this.x,this.y);};function UIElementContainer(a){this.rect=a;this.elements=[];}UIElementContainer.prototype.addUIElement=function(b,a,c){if(!b instanceof UIElement){throw"Did not pass in a UIElement";}b.setPosition(this.rect.x+a,this.rect.y+c);this.elements.push(b);};UIElementContainer.prototype.display=function(c){this.displayBackground(c);for(var b=0;b<this.elements.length;b++){var a=this.elements[b];a.display(c);}};UIElementContainer.prototype.displayBackground=function(a){game.game_engine.getContext().clearRect(this.rect_x,this.rect_y,this.rect.width,this.rect.height);};function GameState(){this.score=0;this.best_score=0;this.player=new Player();this.lasers=[];this.triggers=[];this.effects=[];this.effect_count=0;this.current_level=null;this.new_score=false;}GameState.prototype.init=function(){this.player.init();this.current_level=game.level_map.getLevel();this.current_level.init();};GameState.prototype.addScore=function(){this.score++;if(this.score>this.best_score){this.best_score=this.score;this.new_score=true;}};GameState.prototype.reset=function(){this.player.reset();this.lasers=[];this.effects=[];this.effect_count=0;this.score=0;this.new_score=false;game.game_engine.setCamera(0,0);this.current_level=game.level_map.getLevel();this.current_level.init();};GameState.prototype.addLaser=function(e){var d=Math.random();if(d<0.04){var b=new Laser();var a=new Laser();b.init(e,true);a.init(e,false);this.lasers.push(b);this.lasers.push(a);}else{if(d>0.52){var c=new Laser();c.init(e,true);this.lasers.push(c);}else{var c=new Laser();c.init(e,false);this.lasers.push(c);}}game.sound_map.getSound("laser").play();};GameState.prototype.scrollDown=function(){this.current_level.addRow();};GameState.prototype.createDiedEffect=function(a,d,b){var c=new PlayerDiedEffect(a,d,b);c.id=this.effect_count++;this.effects.push(c);};GameState.prototype.removeEffect=function(c){for(var b=0,a=this.effects.length;b<a;b++){if(this.effects[b].id==c.id){this.effects.splice(b,1);return;}}};Laser.prototype=Object.create(Actor.prototype);Laser.parent=Actor.prototype;Laser.HEIGHT=32;Laser.WIDTH=320;Laser.VELOCITY=270;function Laser(){this.constructor(new Rectangle(0,0,Laser.WIDTH,Laser.HEIGHT),"laser");}Laser.prototype.init=function(c,b){var a=(b)?game.WINDOW_WIDTH:-Laser.WIDTH;Laser.parent.init.call(this,a,c,"static");if(b){this.x_velocity=-Laser.VELOCITY;}else{this.x_velocity=Laser.VELOCITY;}};Laser.prototype.oncollide=function(b,a){};Laser.prototype.think=function(a){if(this.x_velocity>0&&this.x>0){this.x_velocity=0;this.x=0;}else{if(this.x_velocity<0&&this.x<0){this.x_velocity=0;this.x=0;}}};Laser.prototype.remove=function(){};LaserTrigger.prototype=Object.create(Actor.prototype);LaserTrigger.parent=Actor.prototype;LaserTrigger.HEIGHT=1;LaserTrigger.WIDTH=320;LaserTrigger.BEAM_DELAY=0.07;function LaserTrigger(){this.constructor(new Rectangle(0,0,LaserTrigger.WIDTH,LaserTrigger.HEIGHT),"trigger");}LaserTrigger.prototype.init=function(a,b){LaserTrigger.parent.init.call(this,a,b,"static");this.triggered=false;};LaserTrigger.prototype.oncollide=function(b,a){if(b instanceof Player&&this.triggered==false){this.triggered=true;game.game_state.scrollDown();this.setTimer(LaserTrigger.BEAM_DELAY,"createLaser");}};LaserTrigger.prototype.createLaser=function(){game.game_state.addLaser(Math.floor(this.y/SwiftyBeamsLevel.TILE_SIZE)*SwiftyBeamsLevel.TILE_SIZE);};Player.prototype=Object.create(Actor.prototype);Player.parent=Actor.prototype;function Player(){this.constructor(new Rectangle(0,Player.HEIGHT-Player.HITBOX_HEIGHT,Player.WIDTH,Player.HITBOX_HEIGHT),"player");}Player.prototype.init=function(){Player.START_X=(game.WINDOW_WIDTH/2)-(Player.WIDTH/2);Player.START_Y=((game.WINDOW_HEIGHT-SwiftyBeamsUIContainer.HEIGHT)/2)-(Player.HEIGHT/2);Player.parent.init.call(this,Player.START_X,Player.START_Y);this.direction="";this.alive=true;this.falling=true;this.reset();};Player.WIDTH=24;Player.HEIGHT=32;Player.HITBOX_HEIGHT=24;Player.FALLING_HITBOX_HEIGHT=32;Player.MAX_VELOCITY=220;Player.ACCELERATION=1500;Player.AIR_ACCELERATION=850;Player.AIR_DECELERATION=3000;Player.DECELERATION=2000;Player.GRAVITY_ACCELERATION=2500;Player.prototype.reset=function(){this.x=Player.START_X;this.y=Player.START_Y;this.direction="right";this.alive=true;this.falling=true;this.stopHorizontal();this.stopVertical();};Player.prototype.moveLeft=function(b){var a=(this.y_velocity>0)?Player.AIR_ACCELERATION:Player.ACCELERATION;this.x_velocity-=a*b;this.x_velocity=Math.max(this.x_velocity,-Player.MAX_VELOCITY);};Player.prototype.moveRight=function(b){var a=(this.y_velocity>0)?Player.AIR_ACCELERATION:Player.ACCELERATION;this.x_velocity+=a*b;this.x_velocity=Math.min(this.x_velocity,Player.MAX_VELOCITY);};Player.prototype.prethink=function(a){if(this.alive){this.y_velocity+=Player.GRAVITY_ACCELERATION*a;}};Player.prototype.think=function(a){if(this.alive){if(this.x<0){this.x=0.01;this.stopHorizontal();}if(this.x+this.hitbox.width>game.WINDOW_WIDTH){this.x=game.WINDOW_WIDTH-this.hitbox.width-0.01;this.stopHorizontal();}if(this.x_velocity<0){this.setDirection("left");}if(this.x_velocity>0){this.setDirection("right");}}};Player.prototype.setDirection=function(a){this.direction=a;this.queueAnimationName();};Player.prototype.queueAnimationName=function(){if(!this.alive){return;}if(this.y_velocity!=0){this.animation_name="fall";}else{if(this.x_velocity!=0){this.animation_name="walk";}else{this.animation_name="stand";}}this.animation_name=this.animation_name+this.direction;};Player.prototype.updateAnimation=function(){if(this.sprite.current_animation.name!=this.animation_name){this.sprite.playAnimation(this.animation_name);}};Player.prototype.slowHorizontal=function(a){if(this.x_velocity<0){this.x_velocity+=Player.DECELERATION*a;if(this.x_velocity>0){this.stopHorizontal();}}else{if(this.x_velocity>0){this.x_velocity-=Player.DECELERATION*a;if(this.x_velocity<0){this.stopHorizontal();}}}this.queueAnimationName();};Player.prototype.setFallingFlag=function(){this.falling=true;};Player.prototype.tryToFall=function(){if(this.falling){this.y_velocity+=Player.GRAVITY_ACCELERATION;}};Player.prototype.stopVertical=function(){Player.parent.stopVertical.call(this);this.queueAnimationName();};Player.prototype.stopHorizontal=function(){Player.parent.stopHorizontal.call(this);this.queueAnimationName();};Player.prototype.oncollide=function(b,a){if(b instanceof LevelTile){if((a.getSide(CollisionSides.sides.LEFT)||a.getSide(CollisionSides.sides.RIGHT))&&a.getSide(CollisionSides.sides.BOTTOM)){if(this.getCollisionSubframeTime(b,true)<this.getCollisionSubframeTime(b,false)){a.removeSide(CollisionSides.sides.BOTTOM);}else{a.removeSide(CollisionSides.sides.LEFT);a.removeSide(CollisionSides.sides.RIGHT);}}this.collideStop(b,a);}else{if(b instanceof Laser){this.die();}}};Player.prototype.die=function(){game.sound_map.getSound("died").play();for(var a=0;a<8;a++){game.game_state.createDiedEffect(this.x,this.y,Math.PI*a/4);}this.alive=false;this.stopVertical();this.stopHorizontal();game.transition("gameover");};PlayerDiedEffect.prototype=Object.create(Effect.prototype);PlayerDiedEffect.parent=Effect.prototype;PlayerDiedEffect.TIME=5;PlayerDiedEffect.VELOCITY=300;PlayerDiedEffect.GRAVITY_ACCELERATION=450;PlayerDiedEffect.SIZE=8;PlayerDiedEffect.COLOR="#4492C5";PlayerDiedEffect.SHADOWS=2;function PlayerDiedEffect(a,c,b){this.constructor(a,c,PlayerDiedEffect.TIME);this.x_velocity=PlayerDiedEffect.VELOCITY*Math.cos(b);this.y_velocity=PlayerDiedEffect.VELOCITY*Math.sin(b);this.shadows=[];}PlayerDiedEffect.prototype.think=function(a){this.x+=this.x_velocity*a;this.y+=this.y_velocity*a;this.y_velocity+=a*PlayerDiedEffect.GRAVITY_ACCELERATION;this.shadows.shift([this.x,this.y]);this.shadows.splice(PlayerDiedEffect.SHADOWS,1);};PlayerDiedEffect.prototype.display=function(b){b.fillStyle=PlayerDiedEffect.COLOR;b.fillRect(this.x-game.game_engine.camera_x,this.y-game.game_engine.camera_y,PlayerDiedEffect.SIZE,PlayerDiedEffect.SIZE);for(var a=0;a<PlayerDiedEffect.SHADOWS;a++){if(!this.shadows[a]){break;}var c=this.shadows[a];b.fillRect(c[0],c[1],PlayerDiedEffect.SIZE,PlayerDiedEffect.SIZE);}};ScoreEffect.prototype=Object.create(Effect.prototype);ScoreEffect.parent=Effect.prototype;ScoreEffect.FONT="20px Acknowledge TT BRK";ScoreEffect.TIME=1;ScoreEffect.VELOCITY=25;ScoreEffect.RGB="0,0,0";function ScoreEffect(a,c,b){this.constructor(a,c,ScoreEffect.TIME);this.score=b;this.alpha=1;}ScoreEffect.prototype.think=function(a){this.alpha-=(a/ScoreEffect.TIME);this.y-=a*ScoreEffect.VELOCITY;};ScoreEffect.prototype.display=function(a){a.textAlign="center";a.fillStyle="rgba("+ScoreEffect.RGB+","+this.alpha+")";a.fillText(this.score,this.x,this.y);};ScoreTrigger.prototype=Object.create(Actor.prototype);ScoreTrigger.parent=Actor.prototype;ScoreTrigger.HEIGHT=4;ScoreTrigger.WIDTH=320;ScoreTrigger.BEAM_DELAY=0.2;function ScoreTrigger(){this.constructor(new Rectangle(0,0,ScoreTrigger.WIDTH,ScoreTrigger.HEIGHT),"trigger");}ScoreTrigger.prototype.init=function(a,b){ScoreTrigger.parent.init.call(this,a,b,"static");this.triggered=false;};ScoreTrigger.prototype.oncollide=function(b,a){if(b instanceof Player&&this.triggered==false){this.triggered=true;game.sound_map.getSound("score").play();game.game_state.addScore();}};function SwiftyBeams(){this.constructor("SwiftyBeamsPreloader");}SwiftyBeams.prototype=Object.create(Game.prototype);SwiftyBeams.parent=Game.prototype;function init(){game=new SwiftyBeams();game.init();}Game.prototype.initResolution=function(){this.WINDOW_HEIGHT=320;this.WINDOW_WIDTH=320;this.FRAME_RATE=60;};SwiftyBeams.prototype.initLevelMap=function(){this.level_map=new SwiftyBeamsLevelMap();};SwiftyBeams.prototype.initUI=function(){this.ui_container=new SwiftyBeamsUIContainer();};SwiftyBeams.prototype.initGamePhases=function(){this.game_phase_map.addPhase("title","TitlePhase",["run"]);this.game_phase_map.addPhase("run","GameRunPhase",["pause","gameover"]);this.game_phase_map.addPhase("pause","PausePhase",["run"]);this.game_phase_map.addPhase("gameover","GameOverPhase",["run"]);this.initPhase("title");};SwiftyBeams.prototype.initSpriteSheets=function(){this.sprite_sheet_map.addSpriteSheet("laser",new SpriteSheet("laser.png",[new Animation("static",[new Frame(new Rectangle(0,0,Laser.WIDTH,Laser.HEIGHT),1)],true)]));this.sprite_sheet_map.addSpriteSheet("trigger",new SpriteSheet("trigger.png",[new Animation("static",[new Frame(new Rectangle(0,0,LaserTrigger.WIDTH,LaserTrigger.HEIGHT),1)],true)]));this.sprite_sheet_map.addSpriteSheet("player",new SpriteSheet("player.png",[new Animation("standright",[new Frame(new Rectangle(Player.WIDTH,0,Player.WIDTH,Player.HEIGHT),1)]),new Animation("standleft",[new Frame(new Rectangle(0,0,Player.WIDTH,Player.HEIGHT),1)]),new Animation("fallright",[new Frame(new Rectangle(Player.WIDTH,Player.HEIGHT*4,Player.WIDTH,Player.HEIGHT),1)]),new Animation("fallleft",[new Frame(new Rectangle(0,Player.HEIGHT*4,Player.WIDTH,Player.HEIGHT),1)]),new Animation("walkright",[new Frame(new Rectangle(Player.WIDTH,Player.HEIGHT*2,Player.WIDTH,Player.HEIGHT),0.1),new Frame(new Rectangle(Player.WIDTH,Player.HEIGHT*1,Player.WIDTH,Player.HEIGHT),0.1),new Frame(new Rectangle(Player.WIDTH,Player.HEIGHT*3,Player.WIDTH,Player.HEIGHT),0.1),new Frame(new Rectangle(Player.WIDTH,Player.HEIGHT*1,Player.WIDTH,Player.HEIGHT),0.1)],true),new Animation("walkleft",[new Frame(new Rectangle(0,Player.HEIGHT*2,Player.WIDTH,Player.HEIGHT),0.1),new Frame(new Rectangle(0,Player.HEIGHT*1,Player.WIDTH,Player.HEIGHT),0.1),new Frame(new Rectangle(0,Player.HEIGHT*3,Player.WIDTH,Player.HEIGHT),0.1),new Frame(new Rectangle(0,Player.HEIGHT*1,Player.WIDTH,Player.HEIGHT),0.1)],true)]));};SwiftyBeams.prototype.initTiles=function(){this.tile_map.addTileSet("wall",new TileSet("platforms.png",[new Rectangle(0,0,32,32),new Rectangle(32,0,32,32),new Rectangle(64,0,32,32),new Rectangle(96,0,32,32)]));};SwiftyBeams.prototype.initBackgroundImages=function(){this.background_image_map.addBackgroundImage("background",new BackgroundImage("sbbackground.png"));this.background_image_map.addBackgroundImage("logo",new BackgroundImage("logo.png"));this.background_image_map.addBackgroundImage("gameover",new BackgroundImage("gameover.png"));};SwiftyBeams.prototype.initFonts=function(){this.game_engine.initFont("Silkscreen","slkscr.ttf","truetype");};SwiftyBeams.prototype.initKeys=function(){this.game_engine.key_handler.registerKey("LEFT_ARROW",37,true);this.game_engine.key_handler.registerKey("RIGHT_ARROW",39,true);this.game_engine.key_handler.registerKey("RUN",32,false);this.game_engine.key_handler.registerKey("VOLUME_UP",187,false);this.game_engine.key_handler.registerKey("VOLUME_DOWN",189,false);};SwiftyBeams.prototype.initSounds=function(){this.sound_map.addSound("died",new Sound("died.wav"));this.sound_map.addSound("laser",new Sound("laser.wav"));this.sound_map.addSound("score",new Sound("score.wav"));};SwiftyBeams.prototype.showVolume=function(){this.ui_container.showVolume();};SwiftyBeamsBestCounter.prototype=Object.create(TextUIElement.prototype);SwiftyBeamsBestCounter.parent=TextUIElement.prototype;function SwiftyBeamsBestCounter(){TextUIElement.call(this,"16px Silkscreen","#ffffff");}SwiftyBeamsBestCounter.prototype.getValue=function(){return game.game_state.best_score;};SwiftyBeamsLevel.prototype=Object.create(Level.prototype);SwiftyBeamsLevel.parent=Level.prototype;SwiftyBeamsLevel.TILE_SIZE=32;SwiftyBeamsLevel.INITIAL_EMPTY_ROWS=8;SwiftyBeamsLevel.INITIAL_ROWS=4;SwiftyBeamsLevel.GAP_CHANCE=0.15;function SwiftyBeamsLevel(a){this.constructor(null,"","background");this.triggers=[];}SwiftyBeamsLevel.prototype.initObjects=function(){};SwiftyBeamsLevel.prototype.initBackground=function(){SwiftyBeamsLevel.parent.initBackground.call(this);this.background_image.setParallax(0.5);};SwiftyBeamsLevel.prototype.initGeometry=function(){this.geometry=new TileGeometry(SwiftyBeamsLevel.TILE_SIZE,game.WINDOW_WIDTH,game.WINDOW_HEIGHT,"","wall");for(var a=0;a<SwiftyBeamsLevel.INITIAL_EMPTY_ROWS*10;a++){this.geometry.string=this.geometry.string+" ";}for(var a=0;a<SwiftyBeamsLevel.INITIAL_ROWS;a++){this.addRow();}};SwiftyBeamsLevel.prototype.addRow=function(){var n=this.geometry.tiles_wide;var c="";for(var f=0;f<n;f++){c=c+" ";}var l="";do{l="";for(var f=0;f<n;f++){if(Math.random()<SwiftyBeamsLevel.GAP_CHANCE){l=l+" ";}else{l=l+"0";}}}while(!l.match(/ 0+ /));var d="";for(var f=0;f<n;f++){var j=l.charAt(f);if(j==" "){d=d+" ";continue;}var a=false;var m=false;if(f==0||l.charAt(f-1)==" "){a=true;}if(f==n-1||l.charAt(f+1)==" "){m=true;}var e=2;if(a&&m){e=0;}if(a&&!m){e=1;}if(!a&&m){e=3;}d=d+e;}this.geometry.string=this.geometry.string+c+d;this.geometry.height+=2*SwiftyBeamsLevel.TILE_SIZE;var h=this.geometry.string.length/n;var k=(h*SwiftyBeamsLevel.TILE_SIZE)+(SwiftyBeamsLevel.TILE_SIZE-2);var g=new LaserTrigger();g.init(0,k);this.triggers.push(g);var b=new ScoreTrigger();b.init(0,k+3+Player.HEIGHT);this.triggers.push(b);};function SwiftyBeamsLevelMap(){}SwiftyBeamsLevelMap.prototype.getLevel=function(){return new SwiftyBeamsLevel();};function TitlePhase(){}TitlePhase.prototype=Object.create(GamePhase.prototype);TitlePhase.parent=GamePhase.prototype;TitlePhase.prototype.updateLogic=function(a,b){};TitlePhase.prototype.interpretInput=function(a,c,b){if(b.RUN){game.transition("run");}};TitlePhase.prototype.renderGraphics=function(a,b){a.current_level.renderBackground(b);this.logo.display(16,16,288,288,b,false);b.fillStyle="#55200a";b.font="16px Silkscreen";b.textAlign="center";b.fillText("2014 by Mark Goetz",game.WINDOW_WIDTH/2,72);b.fillText("Instructions:",game.WINDOW_WIDTH/2,112);b.fillText("Use the arrow keys to move",game.WINDOW_WIDTH/2,144);b.fillText("Fall as far as you can",game.WINDOW_WIDTH/2,160);b.fillText("Oh, and don't get lasered",game.WINDOW_WIDTH/2,176);b.fillText("Press space to start",game.WINDOW_WIDTH/2,256);};TitlePhase.prototype.transitionTo=function(){this.logo=game.background_image_map.getBackgroundImage("logo");};function GameGraphicsPhase(){}GameGraphicsPhase.prototype=Object.create(GamePhase.prototype);GameGraphicsPhase.parent=GamePhase.prototype;GameGraphicsPhase.prototype._displayGameGraphics=function(a,c){game.game_engine.setCamera(0,a.player.y-(SwiftyBeamsLevel.TILE_SIZE*3));a.current_level.renderBackground(c);a.current_level.renderGeometry(c);if(a.player.alive){a.player.display(c);}for(var b=0;b<a.lasers.length;b++){a.lasers[b].display(c);}for(var b=0;b<a.effects.length;b++){a.effects[b].display(c);}game.ui_container.display(c);};function GameRunPhase(){}GameRunPhase.prototype=Object.create(GameGraphicsPhase.prototype);GameRunPhase.parent=GameGraphicsPhase.prototype;GameRunPhase.prototype.updateLogic=function(a,d){a.player.step(d);a.current_level.geometryCheck(a.player);for(var b=0;b<a.lasers.length;b++){var c=a.lasers[b];c.step(d);a.player.collisionTest(c);}for(var b=0;b<a.current_level.triggers.length;b++){a.current_level.triggers[b].step(d);a.current_level.triggers[b].collisionTest(a.player);}for(b=0;b<a.effects.length;b++){a.effects[b].step(d);}game.ui_container.step(d);a.player.updateAnimation();};GameRunPhase.prototype.interpretInput=function(a,d,c){var b=a.player;if(c.LEFT_ARROW){b.moveLeft(d);}else{if(c.RIGHT_ARROW){b.moveRight(d);}else{b.slowHorizontal(d);}}if(c.RUN){game.transition("pause");}if(c.VOLUME_UP){game.game_engine.volumeUp();game.showVolume();}else{if(c.VOLUME_DOWN){game.game_engine.volumeDown();game.showVolume();}}};GameRunPhase.prototype.renderGraphics=function(a,b){this._displayGameGraphics(a,b);};function PausePhase(){}PausePhase.prototype=Object.create(GameGraphicsPhase.prototype);PausePhase.parent=GameGraphicsPhase.prototype;PausePhase.prototype.updateLogic=function(a,b){game.ui_container.step(b);};PausePhase.prototype.interpretInput=function(a,c,b){if(b.RUN){game.transition("run");}};PausePhase.prototype.renderGraphics=function(a,b){this._displayGameGraphics(a,b);};function GameOverPhase(){}GameOverPhase.prototype=Object.create(GameGraphicsPhase.prototype);GameOverPhase.parent=GameGraphicsPhase.prototype;GameOverPhase.NEW_SCORE_FLASH_TIME=0.4;GameOverPhase.NEW_SCORE_TEXT_RGB="20,77,158";GameOverPhase.FILL_RGB="196,255,203";GameOverPhase.TEXT_RGB="85,33,10";GameOverPhase.SCORE_STROKE_RGB="85,33,10";GameOverPhase.SCORE_FILL_RGB="231,197,182";GameOverPhase.FADEIN_TIME=0.66;GameOverPhase.prototype.updateLogic=function(a,d){for(var b=0;b<a.lasers.length;b++){var c=a.lasers[b];c.step(d);}for(b=0;b<a.effects.length;b++){a.effects[b].step(d);}if(this.alpha<1){this.alpha+=(d/GameOverPhase.FADEIN_TIME);if(this.alpha>=1){this.alpha=1;}}if(a.new_score){if(this.new_score_increasing){this.new_score_alpha+=(d/GameOverPhase.NEW_SCORE_FLASH_TIME);if(this.new_score_alpha>=1){this.new_score_alpha=1;this.new_score_increasing=false;}}else{this.new_score_alpha-=(d/GameOverPhase.NEW_SCORE_FLASH_TIME);if(this.new_score_alpha<=1e-10){this.new_score_alpha=0;this.new_score_increasing=true;}}}};GameOverPhase.prototype.interpretInput=function(a,c,b){if(b.RUN){game.transition("run");}};GameOverPhase.prototype.renderGraphics=function(a,b){this._displayGameGraphics(a,b);b.globalAlpha=this.alpha;this.game_over_bg.display(16,16,288,288,b,false);b.fillStyle="rgb("+GameOverPhase.TEXT_RGB+")";b.font="16px Silkscreen";b.textAlign="center";b.fillText("Yup, you got lasered",game.WINDOW_WIDTH/2,80);b.fillText("Score:",game.WINDOW_WIDTH/4+8,112);b.fillText("Best:",game.WINDOW_WIDTH*3/4+8,112);b.fillText("Press space to restart",game.WINDOW_WIDTH/2,256);if(a.new_score){b.fillStyle="rgba("+GameOverPhase.NEW_SCORE_TEXT_RGB+","+this.new_score_alpha+")";b.fillText("New high score!",game.WINDOW_WIDTH/2,192);}b.font="24px Silkscreen";b.fillStyle="rgb("+GameOverPhase.SCORE_FILL_RGB+")";b.strokeStyle="rgb("+GameOverPhase.SCORE_STROKE_RGB+")";b.lineWidth=5;b.strokeText(a.score,game.WINDOW_WIDTH/4+8,128);b.fillText(a.score,game.WINDOW_WIDTH/4+8,128);b.strokeText(a.best_score,game.WINDOW_WIDTH*3/4+8,128);b.fillText(a.best_score,game.WINDOW_WIDTH*3/4+8,128);b.globalAlpha=1;};GameOverPhase.prototype.transitionTo=function(){if(this.game_over_bg==null){this.game_over_bg=game.background_image_map.getBackgroundImage("gameover");}this.alpha=0;if(game.game_state.new_score){this.new_score_increasing=true;this.new_score_alpha=0;}};GameOverPhase.prototype.transitionFrom=function(){game.game_engine.getGraphicsContext().globalAlpha=1;game.game_state.reset();};SwiftyBeamsPreloader.prototype=Object.create(Preloader.prototype);SwiftyBeamsPreloader.parent=Preloader.prototype;function SwiftyBeamsPreloader(b,a){this.constructor(b,a);}SwiftyBeamsPreloader.prototype.renderPreloader=function(c){var b=this.getLoadedCount();var d=this.getTotalCount();var e=64;var f=this.width-2*32;var a=32;var g=(this.height-e)/2;c.strokeStyle="#000000";c.lineWidth=5;c.strokeRect(a,g,f,e);c.fillStyle="#00ff00";c.fillRect(a,g,f*(b/d),e);};SwiftyBeamsScoreCounter.prototype=Object.create(TextUIElement.prototype);SwiftyBeamsScoreCounter.parent=TextUIElement.prototype;function SwiftyBeamsScoreCounter(){TextUIElement.call(this,"16px Silkscreen","#ffffff");}SwiftyBeamsScoreCounter.prototype.getValue=function(){return game.game_state.score;};SwiftyBeamsUIContainer.prototype=Object.create(UIElementContainer.prototype);SwiftyBeamsUIContainer.parent=UIElementContainer.prototype;SwiftyBeamsUIContainer.HEIGHT=32;function SwiftyBeamsUIContainer(){this.constructor(new Rectangle(0,game.WINDOW_HEIGHT-SwiftyBeamsUIContainer.HEIGHT,game.WINDOW_WIDTH,SwiftyBeamsUIContainer.HEIGHT));this.addUIElement(new SwiftyBeamsBestCounter(),game.WINDOW_WIDTH-24,16);this.addUIElement(new SwiftyBeamsScoreCounter(),48,16);this.addUIElement(new SwiftyBeamsVolumeDisplay(),(game.WINDOW_WIDTH-21*SwiftyBeams.BAR_WIDTH)/2,0);}SwiftyBeamsUIContainer.prototype.displayBackground=function(a){a.fillStyle="#000000";a.fillRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height);a.font="16px Silkscreen";a.fillStyle="#ffffff";a.textAlign="left";a.fillText("SCORE",8,this.rect.y);a.textAlign="right";a.fillText("BEST",this.rect.width-8,this.rect.y);};SwiftyBeamsUIContainer.prototype.showVolume=function(){this.elements[2].turnOn();};SwiftyBeamsUIContainer.prototype.step=function(a){this.elements[2].step(a);};SwiftyBeamsVolumeDisplay.prototype=Object.create(UIElement.prototype);SwiftyBeamsVolumeDisplay.parent=UIElement.prototype;SwiftyBeamsVolumeDisplay.RGB="0,255,0";SwiftyBeamsVolumeDisplay.VISIBLE=0.8;SwiftyBeamsVolumeDisplay.FADEOUT=0.7;SwiftyBeamsVolumeDisplay.HEIGHT=32;SwiftyBeamsVolumeDisplay.BAR_WIDTH=16;function SwiftyBeamsVolumeDisplay(){UIElement.call(this);this.fade_delay=0;}SwiftyBeamsVolumeDisplay.prototype.step=function(a){if(this.fade_delay>0){this.fade_delay-=a;if(this.fade_delay<0){this.fade_delay=0;}}};SwiftyBeamsVolumeDisplay.prototype.display=function(d){if(this.fade_delay==0){return;}var f;if(this.fade_delay>SwiftyBeamsVolumeDisplay.FADEOUT){f=1;}else{f=(this.fade_delay*SwiftyBeamsVolumeDisplay.FADEOUT);}var e=game.game_engine.getVolume();var a=0;var b="rgba("+SwiftyBeamsVolumeDisplay.RGB+","+f+")";d.fillStyle=b;for(var c=0;c<e;c++){d.fillRect(this.x+a,this.y,SwiftyBeamsVolumeDisplay.BAR_WIDTH,SwiftyBeamsVolumeDisplay.HEIGHT);a+=SwiftyBeamsVolumeDisplay.BAR_WIDTH*2;}};SwiftyBeamsVolumeDisplay.prototype.turnOn=function(){this.fade_delay=SwiftyBeamsVolumeDisplay.VISIBLE+SwiftyBeamsVolumeDisplay.FADEOUT;};